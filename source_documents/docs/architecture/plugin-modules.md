---
title: Plugin Modules
navTitle: Plugin Modules
---

[Â« Architecture Documentation - Table of Contents](index.md)

# Plugin Modules

Note: This document details a component of [Plugin](plugin.md).

- [What Is A "Plugin Module"?](#what-is-a-plugin-module)
- [Creating a Plugin Module](#creating-a-plugin-module)
- [Directory Structure](#directory-structure)

## What Is A "Plugin Module?"

A Plugin Module is a framework that encapsulates a desired feature or feature set.  They contain all of the code needed to fulfill their intended functionality, such as Networking Clients, UIs, and Models.  A Plugin Module should also include an accompanying Unit Testing target, allowing tests to be written that verify all testable components of a given feature independent of a Parent App.  

Plugin Modules should adhere to a matching public interface declared within the PluginsAPIs framework.  This aids in mocking / testing, and also allows Module instances to be passed, stored, and used without needing to declare dependency upon the Plugin Modules themselves.

Plugin Modules can exist entirely independent of any specific Parent App, but after going the multi-repository route with past projects, we found benefits similar to [Uber's own engineering team](https://eng.uber.com/ios-monorepo/) when employing single-repository development.  That led us to adopt the practice on larger projects and, as a result, all Walmart App Plugin Modules are located within the Walmart App Xcode Project itself.  (You can find them located within the Plugins directory at the top level of the App.)

### Plugin Module Examples

When authoring a new Plugin, much like any new component of a heavily-modularized project, it's good practice to first look over how other teams have authored their own.  This will likely answer most questions that could arise throughout the process, and will help to inform you overall of any patterns that are being employed that you may have otherwise missed.

Looking through the Walmart App, here are a few examples of Plugin Modules which are currently in use, each residing within their own Xcode projects:

- [`Authentication` module](https://gecgithub01.walmart.com/walmart-ios/glass-app/tree/development/Plugins/Authentication/Authentication/)
- [`CXO` module](https://gecgithub01.walmart.com/walmart-ios/glass-app/tree/development/Plugins/CXO/CXO/Sources/)
- [`Home` module](https://gecgithub01.walmart.com/walmart-ios/glass-app/tree/development/Plugins/Home/Home/Sources/)
- [`PurchaseHistory` module](https://gecgithub01.walmart.com/walmart-ios/glass-app/tree/development/Plugins/PurchaseHistory/PurchaseHistory/Sources/)
- [`Search`  module](https://gecgithub01.walmart.com/walmart-ios/glass-app/tree/development/Plugins/Search/Search/Sources/)

See [the Plugins directory](https://gecgithub01.walmart.com/walmart-ios/glass-app/tree/development/Plugins/) for more.

## Creating A Plugin Module
<details>
<summary>1. Generating the Project [tap to expand]</summary>
<br />

Plugin modules are generated by the Glass CLI tool. To use the tool follow these steps:

<details>
<summary>1-1. Install the CLI tools</summary>
<br />
Go to `glass-app/`

The plugin module generation script requires [tuist](https://github.com/tuist/tuist). 
Install tuist (the version is determined by our .tuist-version file)

```sh
bash <(curl -Ls https://install.tuist.io) && /usr/local/bin/tuist
```

If you have issues with this command try running it while not connected to VPN.

Install the latest version of the Glass CLI tool using the following command:

```sh
./scripts/install-glass-cli.swift
```

</details>
<details>
<summary>1-2. Generate your project</summary>
<br />

The tool has two options when creating a plugin, PlatformAPI or Feature module. Determine which you need, if you need help reach out to the Platform Team On-Call `@glass-platform-ios` in #glass-ios.

Go to `glass-app/`

For Feature Plugins run:

```sh
glass generate plugin -s feature -n <The Name of your Feature>
```

This will do the following:

- Generates a new Xcode project located in `Plugins/MyAwesomeFeature`.
  - Framework build target
  - Resources bundle build target
  - Test build target
- `Plugins/MyAwesomeFeature/MyAwesomeFeature/Sources/Plugin/MyAwesomeFeaturePluginAPI.swift`- An empty class stub for your feature's API implementation.
- `Plugins/PluginAPIs/PluginAPIs/APIs/MyAwesomeFeatureAPI.swift` - An empty protocol stub for your feature's API
- `Plugins/PluginAPIs/PluginAPIsMocks/MyAwesomeFeatureAPIMock.swift` - An empty mock implementation of you feature's new API. Implementing this is mandatory to reduce coupling of features to other feature's tests and demo apps.
- Adds the new XcodeProject as a dependency of the main Walmart target, linking it's targets to the appropriate places.
- Adds GlassUI, WalmartPlatform, and TestUtilities as dependencies to the new project, linking their targets in the appropriate places.
- Adds MyAwesomeFeatureAPI.swift as a compile source of the PluginAPIs framework
- Adds MyAwesomeFeatureAPIMock.swift as a compile source of the PluginAPIsMocks framework


For PlatformAPIs run:

```sh
glass generate plugin -s platform -n <The Name of your Platform API>
```

This will do the following:

- Generates a new Xcode project located in `Platform/PlatformAPIs/MyAwesomeFeature`.
  - Framework build target
  - Resources bundle build target
  - Test build target
- `Platform/PlatformAPIs/MyAwesomeFeature/MyAwesomeFeature/Sources/Plugin/MyAwesomeFeaturePluginAPI.swift`- An empty class stub for your feature's API implementation.
- `Platform/PlatformAPIs/PlatformAPIs/PlatformAPIs/APIs/MyAwesomeFeatureAPI.swift` - An empty protocol stub for your feature's API
- `Platform/PlatformAPIs/PlatformAPIs/PlatformAPIsMocks/MyAwesomeFeatureAPIMock.swift` - An empty mock implementation of you feature's new API. Implementing this is mandatory to reduce coupling of features to other feature's tests and demo apps.
- Adds the new XcodeProject as a dependency of the main Walmart target, linking it's targets to the appropriate places.
- Adds WalmartPlatform, and TestUtilities as dependencies to the new project, linking their targets in the appropriate places.
- Adds MyAwesomeFeatureAPI.swift as a compile source of the PluginAPIs framework
- Adds MyAwesomeFeatureAPIMock.swift as a compile source of the PluginAPIsMocks framework

</details>
</details>

<details>
<summary>2. Adding dependencies to your plugin module's Xcode project</summary>
<br />
The tool handles adding the most common dependencies, but if your feature requires additional dependencies you will need to add them manually. This to will become automated in the future. 

Follow the steps outlined in `5. Adding a Dependency` to add the following dependencies:

- Add `PluginAPIs`, `WalmartPlatform`, `GlassUI`, and `LivingDesign` to your plugin module's framework target
- Add `TestUtilities` to your plugin module's test target

</details>
<details>
<summary>3. Adding a Test Plan for your tests</summary>
<br />

- Add file to tests folder, select Test Plan
- Name this file {Plugin}(UI/Unit)Default(.xctestplan). Make one test plan for UI and one for Unit. 
- Add just your tests to this file
- Go to Configurations -> Shared Configurations
- Add environment variable "UNIT_TESTING": "1"
- Change code coverage to "Some targets" and choose just your {Plugin} framework target
- Go to Product - Scheme and select the Walmart scheme
- Go to Product - Scheme - Edit Scheme. Add your test plan with +, then Add existing test plan. Select the {Plugin}(UI/Unit)Default(.xctestplan)
- Duplicate this test scheme and rename to {Plugin}(UI/Unit)Internal(.xctestplan)
- Go to Product - Scheme and select your plugin scheme
- Go to Product - Scheme - Edit Scheme. Add your test plan with +, then Add existing test plan. Select the {Plugin}(UI/Unit)Internal(.xctestplan)

The "internal" test plan will be used to run your tests within your plugin target.
The "default" test plan will be used by the Walmart target while running all tests.

</details>
<details>
<summary>4. Build your plugin module's framework</summary>
<br />

- Select your module scheme in the top left of Xcode and build your project's framework target to verify everything is setup correctly

</details>
<details>
<summary>5. Adding a Dependency</summary>
<br />

- Open your plugin module's Xcode project or navigate to it in the project navigator within the `Walmart.xcodeproj`
- Select your new feature's Xcode project in the project navigator
- Create `Modules` group
  - Right click and select `New Group Without Folder`
  - Name the new group `"Modules"`
- Add Dependency Xcode Project
  - Right click the `Modules` group in the project navigator and click `Add Files To "MyAwesomeFeature"`
  - Find and select the Xcode project of the dependency you're adding
- Configure Build Phases
  - Navigate to your framework target's `Build Phases`
  - Add the dependency to the `Dependencies` build phases  

</details>
<details>
<summary>6. Assigning a Code Owner</summary>
<br />

Every plugin module is required to have a code owner assigned in the [CODEOWNERS](https://gecgithub01.walmart.com/walmart-ios/glass-app/blob/development/.github/CODEOWNERS) file. This file enforces that any changes made to your plugin module require a review from your team before the changes can be merged. Your team will automatically be assigned to any pull request that introduces changes to your plugin module. For typical code changes within a module, Code owners can review and merge their corresponding plugin module code changes autonomously without seeking platform team's involvement.

<details>
<summary>6-1. Create new GitHub team</summary>
<br />

Follow the steps in the [mobile onboarding documentation](https://engineering.walmart.com/docs/mobile/mobile/onboarding) to request creation of a new GitHub team for your team.

Skip this step if you already have a GitHub team.

</details>
<details>
<summary>6-2. Update the CODEOWNERS</summary>
<br />

We don't manually edit [.github/CODEOWNERS](https://gecgithub01.walmart.com/walmart-ios/glass-app/blob/development/.github/CODEOWNERS). Instead, this file is being generated based on the content of `*.glassconf` files listed in [Glass.plist](https://gecgithub01.walmart.com/walmart-ios/glass-app/blob/development/Glass.plist).

Edit your `*.glassconf` specifying paths that are related to your plugin and are owned by your team.

Run the following command to re-generate `.github/CODEOWNERS` file.

```sh
glass code-owners generate
```

Next, update the [CodeOwner.swift](https://gecgithub01.walmart.com/walmart-ios/glass-app/blob/development/Platform/GlassPlatform/WalmartPlatform/Sources/Analytics/Diagnostics/CodeOwner.swift) file by running `./scripts/codeowner-gen.py`

</details>
</details>

<details>
<summary>7. Register your Plugin API</summary>
<br />

Open [`BootstrapProvider.swift`](https://gecgithub01.walmart.com/walmart-ios/glass-app/blob/development/markets/usa/Walmart/Startup/BootstrapProvider.swift) and add you plugin in the `registerServices` function to register your plugin in the app's container.

```swift
func registerServices(in container: Container) {
    container.registerProvidingChild(FeedbackAPI.self, FeedbackPluginAPI.init)
}
```

</details>

### Directory Structure

Directory structure is important so that Sonar code coverage reports do not capture a lack of code coverage for your feature's demo app and test targets.

- `Plugins/MyAwesomeFeature/MyAwesomeFeatureApp` - location of your plugin's demo app target (Sonar ignores `Plugins/*/*App`)
- `Plugins/MyAwesomeFeature/MyAwesomeFeatureTests` - location of your plugin's test target (Sonar ignores `Plugins/*/*Tests`)

